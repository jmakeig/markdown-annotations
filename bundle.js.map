{"version":3,"file":"bundle.js","sources":["../node_modules/lodash-es/_freeGlobal.js","../node_modules/lodash-es/_root.js","../node_modules/lodash-es/_Symbol.js","../node_modules/lodash-es/_getRawTag.js","../node_modules/lodash-es/_objectToString.js","../node_modules/lodash-es/_baseGetTag.js","../node_modules/lodash-es/_overArg.js","../node_modules/lodash-es/_getPrototype.js","../node_modules/lodash-es/isObjectLike.js","../node_modules/lodash-es/isPlainObject.js","../node_modules/symbol-observable/es/ponyfill.js","../node_modules/symbol-observable/es/index.js","../node_modules/redux/es/createStore.js","../node_modules/redux/es/utils/warning.js","../node_modules/redux/es/compose.js","../node_modules/redux/es/applyMiddleware.js","../node_modules/redux/es/index.js","../node_modules/redux-thunk/es/index.js","src/component.js","src/dom-helper.js","src/selectors.js","src/actions.js","src/reducer.js","../node_modules/color-hash/lib/bkdr-hash.js","../node_modules/color-hash/lib/color-hash.js","src/user.js","src/base64.js","src/download.js","src/header.js","src/markdown.js","src/document.js","../node_modules/dom-highlight-range/highlight-range.js","src/selection.js","src/annotation-highlight.js","src/annotation-detail.js","src/annotations.js","src/main.js"],"sourcesContent":["/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nexport default freeGlobal;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nexport default root;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nexport default Symbol;\n","import Symbol from './_Symbol.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nexport default getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nexport default objectToString;\n","import Symbol from './_Symbol.js';\nimport getRawTag from './_getRawTag.js';\nimport objectToString from './_objectToString.js';\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nexport default baseGetTag;\n","/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\nexport default overArg;\n","import overArg from './_overArg.js';\n\n/** Built-in value references. */\nvar getPrototype = overArg(Object.getPrototypeOf, Object);\n\nexport default getPrototype;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nexport default isObjectLike;\n","import baseGetTag from './_baseGetTag.js';\nimport getPrototype from './_getPrototype.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar objectTag = '[object Object]';\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to infer the `Object` constructor. */\nvar objectCtorString = funcToString.call(Object);\n\n/**\n * Checks if `value` is a plain object, that is, an object created by the\n * `Object` constructor or one with a `[[Prototype]]` of `null`.\n *\n * @static\n * @memberOf _\n * @since 0.8.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n * }\n *\n * _.isPlainObject(new Foo);\n * // => false\n *\n * _.isPlainObject([1, 2, 3]);\n * // => false\n *\n * _.isPlainObject({ 'x': 0, 'y': 0 });\n * // => true\n *\n * _.isPlainObject(Object.create(null));\n * // => true\n */\nfunction isPlainObject(value) {\n  if (!isObjectLike(value) || baseGetTag(value) != objectTag) {\n    return false;\n  }\n  var proto = getPrototype(value);\n  if (proto === null) {\n    return true;\n  }\n  var Ctor = hasOwnProperty.call(proto, 'constructor') && proto.constructor;\n  return typeof Ctor == 'function' && Ctor instanceof Ctor &&\n    funcToString.call(Ctor) == objectCtorString;\n}\n\nexport default isPlainObject;\n","export default function symbolObservablePonyfill(root) {\n\tvar result;\n\tvar Symbol = root.Symbol;\n\n\tif (typeof Symbol === 'function') {\n\t\tif (Symbol.observable) {\n\t\t\tresult = Symbol.observable;\n\t\t} else {\n\t\t\tresult = Symbol('observable');\n\t\t\tSymbol.observable = result;\n\t\t}\n\t} else {\n\t\tresult = '@@observable';\n\t}\n\n\treturn result;\n};\n","/* global window */\nimport ponyfill from './ponyfill.js';\n\nvar root;\n\nif (typeof self !== 'undefined') {\n  root = self;\n} else if (typeof window !== 'undefined') {\n  root = window;\n} else if (typeof global !== 'undefined') {\n  root = global;\n} else if (typeof module !== 'undefined') {\n  root = module;\n} else {\n  root = Function('return this')();\n}\n\nvar result = ponyfill(root);\nexport default result;\n","import isPlainObject from 'lodash-es/isPlainObject';\nimport $$observable from 'symbol-observable';\n\n/**\n * These are private action types reserved by Redux.\n * For any unknown actions, you must return the current state.\n * If the current state is undefined, you must return the initial state.\n * Do not reference these action types directly in your code.\n */\nexport var ActionTypes = {\n  INIT: '@@redux/INIT'\n\n  /**\n   * Creates a Redux store that holds the state tree.\n   * The only way to change the data in the store is to call `dispatch()` on it.\n   *\n   * There should only be a single store in your app. To specify how different\n   * parts of the state tree respond to actions, you may combine several reducers\n   * into a single reducer function by using `combineReducers`.\n   *\n   * @param {Function} reducer A function that returns the next state tree, given\n   * the current state tree and the action to handle.\n   *\n   * @param {any} [preloadedState] The initial state. You may optionally specify it\n   * to hydrate the state from the server in universal apps, or to restore a\n   * previously serialized user session.\n   * If you use `combineReducers` to produce the root reducer function, this must be\n   * an object with the same shape as `combineReducers` keys.\n   *\n   * @param {Function} [enhancer] The store enhancer. You may optionally specify it\n   * to enhance the store with third-party capabilities such as middleware,\n   * time travel, persistence, etc. The only store enhancer that ships with Redux\n   * is `applyMiddleware()`.\n   *\n   * @returns {Store} A Redux store that lets you read the state, dispatch actions\n   * and subscribe to changes.\n   */\n};export default function createStore(reducer, preloadedState, enhancer) {\n  var _ref2;\n\n  if (typeof preloadedState === 'function' && typeof enhancer === 'undefined') {\n    enhancer = preloadedState;\n    preloadedState = undefined;\n  }\n\n  if (typeof enhancer !== 'undefined') {\n    if (typeof enhancer !== 'function') {\n      throw new Error('Expected the enhancer to be a function.');\n    }\n\n    return enhancer(createStore)(reducer, preloadedState);\n  }\n\n  if (typeof reducer !== 'function') {\n    throw new Error('Expected the reducer to be a function.');\n  }\n\n  var currentReducer = reducer;\n  var currentState = preloadedState;\n  var currentListeners = [];\n  var nextListeners = currentListeners;\n  var isDispatching = false;\n\n  function ensureCanMutateNextListeners() {\n    if (nextListeners === currentListeners) {\n      nextListeners = currentListeners.slice();\n    }\n  }\n\n  /**\n   * Reads the state tree managed by the store.\n   *\n   * @returns {any} The current state tree of your application.\n   */\n  function getState() {\n    return currentState;\n  }\n\n  /**\n   * Adds a change listener. It will be called any time an action is dispatched,\n   * and some part of the state tree may potentially have changed. You may then\n   * call `getState()` to read the current state tree inside the callback.\n   *\n   * You may call `dispatch()` from a change listener, with the following\n   * caveats:\n   *\n   * 1. The subscriptions are snapshotted just before every `dispatch()` call.\n   * If you subscribe or unsubscribe while the listeners are being invoked, this\n   * will not have any effect on the `dispatch()` that is currently in progress.\n   * However, the next `dispatch()` call, whether nested or not, will use a more\n   * recent snapshot of the subscription list.\n   *\n   * 2. The listener should not expect to see all state changes, as the state\n   * might have been updated multiple times during a nested `dispatch()` before\n   * the listener is called. It is, however, guaranteed that all subscribers\n   * registered before the `dispatch()` started will be called with the latest\n   * state by the time it exits.\n   *\n   * @param {Function} listener A callback to be invoked on every dispatch.\n   * @returns {Function} A function to remove this change listener.\n   */\n  function subscribe(listener) {\n    if (typeof listener !== 'function') {\n      throw new Error('Expected listener to be a function.');\n    }\n\n    var isSubscribed = true;\n\n    ensureCanMutateNextListeners();\n    nextListeners.push(listener);\n\n    return function unsubscribe() {\n      if (!isSubscribed) {\n        return;\n      }\n\n      isSubscribed = false;\n\n      ensureCanMutateNextListeners();\n      var index = nextListeners.indexOf(listener);\n      nextListeners.splice(index, 1);\n    };\n  }\n\n  /**\n   * Dispatches an action. It is the only way to trigger a state change.\n   *\n   * The `reducer` function, used to create the store, will be called with the\n   * current state tree and the given `action`. Its return value will\n   * be considered the **next** state of the tree, and the change listeners\n   * will be notified.\n   *\n   * The base implementation only supports plain object actions. If you want to\n   * dispatch a Promise, an Observable, a thunk, or something else, you need to\n   * wrap your store creating function into the corresponding middleware. For\n   * example, see the documentation for the `redux-thunk` package. Even the\n   * middleware will eventually dispatch plain object actions using this method.\n   *\n   * @param {Object} action A plain object representing “what changed”. It is\n   * a good idea to keep actions serializable so you can record and replay user\n   * sessions, or use the time travelling `redux-devtools`. An action must have\n   * a `type` property which may not be `undefined`. It is a good idea to use\n   * string constants for action types.\n   *\n   * @returns {Object} For convenience, the same action object you dispatched.\n   *\n   * Note that, if you use a custom middleware, it may wrap `dispatch()` to\n   * return something else (for example, a Promise you can await).\n   */\n  function dispatch(action) {\n    if (!isPlainObject(action)) {\n      throw new Error('Actions must be plain objects. ' + 'Use custom middleware for async actions.');\n    }\n\n    if (typeof action.type === 'undefined') {\n      throw new Error('Actions may not have an undefined \"type\" property. ' + 'Have you misspelled a constant?');\n    }\n\n    if (isDispatching) {\n      throw new Error('Reducers may not dispatch actions.');\n    }\n\n    try {\n      isDispatching = true;\n      currentState = currentReducer(currentState, action);\n    } finally {\n      isDispatching = false;\n    }\n\n    var listeners = currentListeners = nextListeners;\n    for (var i = 0; i < listeners.length; i++) {\n      var listener = listeners[i];\n      listener();\n    }\n\n    return action;\n  }\n\n  /**\n   * Replaces the reducer currently used by the store to calculate the state.\n   *\n   * You might need this if your app implements code splitting and you want to\n   * load some of the reducers dynamically. You might also need this if you\n   * implement a hot reloading mechanism for Redux.\n   *\n   * @param {Function} nextReducer The reducer for the store to use instead.\n   * @returns {void}\n   */\n  function replaceReducer(nextReducer) {\n    if (typeof nextReducer !== 'function') {\n      throw new Error('Expected the nextReducer to be a function.');\n    }\n\n    currentReducer = nextReducer;\n    dispatch({ type: ActionTypes.INIT });\n  }\n\n  /**\n   * Interoperability point for observable/reactive libraries.\n   * @returns {observable} A minimal observable of state changes.\n   * For more information, see the observable proposal:\n   * https://github.com/tc39/proposal-observable\n   */\n  function observable() {\n    var _ref;\n\n    var outerSubscribe = subscribe;\n    return _ref = {\n      /**\n       * The minimal observable subscription method.\n       * @param {Object} observer Any object that can be used as an observer.\n       * The observer object should have a `next` method.\n       * @returns {subscription} An object with an `unsubscribe` method that can\n       * be used to unsubscribe the observable from the store, and prevent further\n       * emission of values from the observable.\n       */\n      subscribe: function subscribe(observer) {\n        if (typeof observer !== 'object') {\n          throw new TypeError('Expected the observer to be an object.');\n        }\n\n        function observeState() {\n          if (observer.next) {\n            observer.next(getState());\n          }\n        }\n\n        observeState();\n        var unsubscribe = outerSubscribe(observeState);\n        return { unsubscribe: unsubscribe };\n      }\n    }, _ref[$$observable] = function () {\n      return this;\n    }, _ref;\n  }\n\n  // When a store is created, an \"INIT\" action is dispatched so that every\n  // reducer returns their initial state. This effectively populates\n  // the initial state tree.\n  dispatch({ type: ActionTypes.INIT });\n\n  return _ref2 = {\n    dispatch: dispatch,\n    subscribe: subscribe,\n    getState: getState,\n    replaceReducer: replaceReducer\n  }, _ref2[$$observable] = observable, _ref2;\n}","/**\n * Prints a warning in the console if it exists.\n *\n * @param {String} message The warning message.\n * @returns {void}\n */\nexport default function warning(message) {\n  /* eslint-disable no-console */\n  if (typeof console !== 'undefined' && typeof console.error === 'function') {\n    console.error(message);\n  }\n  /* eslint-enable no-console */\n  try {\n    // This error was thrown as a convenience so that if you enable\n    // \"break on all exceptions\" in your console,\n    // it would pause the execution at this line.\n    throw new Error(message);\n    /* eslint-disable no-empty */\n  } catch (e) {}\n  /* eslint-enable no-empty */\n}","/**\n * Composes single-argument functions from right to left. The rightmost\n * function can take multiple arguments as it provides the signature for\n * the resulting composite function.\n *\n * @param {...Function} funcs The functions to compose.\n * @returns {Function} A function obtained by composing the argument functions\n * from right to left. For example, compose(f, g, h) is identical to doing\n * (...args) => f(g(h(...args))).\n */\n\nexport default function compose() {\n  for (var _len = arguments.length, funcs = Array(_len), _key = 0; _key < _len; _key++) {\n    funcs[_key] = arguments[_key];\n  }\n\n  if (funcs.length === 0) {\n    return function (arg) {\n      return arg;\n    };\n  }\n\n  if (funcs.length === 1) {\n    return funcs[0];\n  }\n\n  return funcs.reduce(function (a, b) {\n    return function () {\n      return a(b.apply(undefined, arguments));\n    };\n  });\n}","var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nimport compose from './compose';\n\n/**\n * Creates a store enhancer that applies middleware to the dispatch method\n * of the Redux store. This is handy for a variety of tasks, such as expressing\n * asynchronous actions in a concise manner, or logging every action payload.\n *\n * See `redux-thunk` package as an example of the Redux middleware.\n *\n * Because middleware is potentially asynchronous, this should be the first\n * store enhancer in the composition chain.\n *\n * Note that each middleware will be given the `dispatch` and `getState` functions\n * as named arguments.\n *\n * @param {...Function} middlewares The middleware chain to be applied.\n * @returns {Function} A store enhancer applying the middleware.\n */\nexport default function applyMiddleware() {\n  for (var _len = arguments.length, middlewares = Array(_len), _key = 0; _key < _len; _key++) {\n    middlewares[_key] = arguments[_key];\n  }\n\n  return function (createStore) {\n    return function (reducer, preloadedState, enhancer) {\n      var store = createStore(reducer, preloadedState, enhancer);\n      var _dispatch = store.dispatch;\n      var chain = [];\n\n      var middlewareAPI = {\n        getState: store.getState,\n        dispatch: function dispatch(action) {\n          return _dispatch(action);\n        }\n      };\n      chain = middlewares.map(function (middleware) {\n        return middleware(middlewareAPI);\n      });\n      _dispatch = compose.apply(undefined, chain)(store.dispatch);\n\n      return _extends({}, store, {\n        dispatch: _dispatch\n      });\n    };\n  };\n}","import createStore from './createStore';\nimport combineReducers from './combineReducers';\nimport bindActionCreators from './bindActionCreators';\nimport applyMiddleware from './applyMiddleware';\nimport compose from './compose';\nimport warning from './utils/warning';\n\n/*\n* This is a dummy function to check if the function name has been altered by minification.\n* If the function has been minified and NODE_ENV !== 'production', warn the user.\n*/\nfunction isCrushed() {}\n\nif (process.env.NODE_ENV !== 'production' && typeof isCrushed.name === 'string' && isCrushed.name !== 'isCrushed') {\n  warning('You are currently using minified code outside of NODE_ENV === \\'production\\'. ' + 'This means that you are running a slower development build of Redux. ' + 'You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify ' + 'or DefinePlugin for webpack (http://stackoverflow.com/questions/30030031) ' + 'to ensure you have the correct code for your production build.');\n}\n\nexport { createStore, combineReducers, bindActionCreators, applyMiddleware, compose };","function createThunkMiddleware(extraArgument) {\n  return function (_ref) {\n    var dispatch = _ref.dispatch,\n        getState = _ref.getState;\n    return function (next) {\n      return function (action) {\n        if (typeof action === 'function') {\n          return action(dispatch, getState, extraArgument);\n        }\n\n        return next(action);\n      };\n    };\n  };\n}\n\nvar thunk = createThunkMiddleware();\nthunk.withExtraArgument = createThunkMiddleware;\n\nexport default thunk;","/**\n * Callback to run *after* the created `Node` is added to the DOM. The name comes from\n * [React’s lifecycle method](https://reactjs.org/docs/react-component.html#componentdidmount).\n *\n * TODO: Does this cause a memory leak?\n */\nexport const onComponentDidMount = Symbol.for('onComponentDidMount');\n","/**\n * Whether something is iterable, not including `string` instances.\n *\n * @param {*} item\n * @param {boolean} [ignoreStrings = true]\n * @return {boolean}\n */\nfunction isIterable(item, ignoreStrings = true) {\n  if (!exists(item)) return false;\n  if ('function' === typeof item[Symbol.iterator]) {\n    return 'string' !== typeof item || !ignoreStrings;\n  }\n  return false;\n}\n/**\n * Whether something is not `undefined` or `null`\n *\n * @param {*} item\n * @return {boolean}\n */\nfunction exists(item) {\n  return !('undefined' === typeof item || null === item);\n}\n/**\n * Whether something doesn’t exist or is *not* an empty `string`\n *\n * @param {*} item\n * @return {boolean}\n */\nfunction isEmpty(item) {\n  return !exists(item) || '' === item;\n}\n/**\n * Guarantees an interable, even if passed a non-iterable,\n * except for `undefined` and `null`, which are returned as-is.\n *\n * @param {*} oneOrMany\n * @return {Iterable|Array|null|undefined}\n */\nfunction toIterable(oneOrMany) {\n  if (!exists(oneOrMany)) return oneOrMany;\n  if (isIterable(oneOrMany)) return oneOrMany;\n  return [oneOrMany];\n}\n\n/**\n * Creates a `Node` instance.\n *\n * @param {Node|string|null|undefined} name\n * @return {Node}\n */\nfunction createElement(name) {\n  if (name instanceof Node) return name;\n  if (isEmpty(name)) return document.createDocumentFragment();\n  return document.createElement(String(name));\n}\n\n/**\n *\n * @param {Iterable|Node|string|Object} param\n * @param {Node} el\n * @return {Node}\n */\nfunction applyToElement(param, el) {\n  if (isIterable(param)) {\n    for (const item of param) {\n      applyToElement(item, el);\n    }\n    return el;\n  }\n\n  if (param instanceof Node) {\n    el.appendChild(param);\n    return el;\n  }\n\n  if ('string' === typeof param) {\n    el.appendChild(document.createTextNode(param));\n    return el;\n  }\n\n  if (exists(param) && 'object' === typeof param) {\n    for (const p of [\n      ...Object.getOwnPropertyNames(param),\n      ...Object.getOwnPropertySymbols(param),\n    ]) {\n      switch (p) {\n        case 'style':\n        case 'dataset':\n          for (let item in param[p]) {\n            el[p][item] = param[p][item];\n          }\n          break;\n        case 'class':\n        case 'className':\n        case 'classList':\n          for (const cls of toIterable(param[p])) {\n            el.classList.add(cls);\n          }\n          break;\n        default:\n          el[p] = param[p];\n      }\n    }\n  }\n  return el;\n}\n\n/**\n *\n * @param {string|Node|undefined|null} name\n * @param {Iterable} rest\n * @return {Node}\n */\nfunction _el(name, ...rest) {\n  const el = createElement(name);\n  for (const param of rest) {\n    applyToElement(param, el);\n  }\n  return el;\n}\n\nexport const toFragment = (...rest) => _el(null, ...rest);\nexport const empty = () => toFragment();\n\nexport const header = (...rest) => _el('header', ...rest);\nexport const nav = (...rest) => _el('nav', ...rest);\nexport const footer = (...rest) => _el('footer', ...rest);\nexport const div = (...rest) => _el('div', ...rest);\nexport const p = (...rest) => _el('p', ...rest);\nexport const h1 = (...rest) => _el('h1', ...rest);\nexport const h2 = (...rest) => _el('h2', ...rest);\nexport const h3 = (...rest) => _el('h3', ...rest);\nexport const h4 = (...rest) => _el('h4', ...rest);\nexport const h5 = (...rest) => _el('h5', ...rest);\nexport const h6 = (...rest) => _el('h6', ...rest);\n\nexport const ul = (...rest) => _el('ul', ...rest);\nexport const ol = (...rest) => _el('ol', ...rest);\nexport const li = (...rest) => _el('li', ...rest);\nexport const dl = (...rest) => _el('dl', ...rest);\nexport const dt = (...rest) => _el('dt', ...rest);\nexport const dd = (...rest) => _el('dd', ...rest);\n\nexport const table = (...rest) => _el('table', ...rest);\nexport const thead = (...rest) => _el('thead', ...rest);\nexport const tfoot = (...rest) => _el('tfoot', ...rest);\nexport const tbody = (...rest) => _el('tbody', ...rest);\nexport const tr = (...rest) => _el('tr', ...rest);\nexport const th = (...rest) => _el('th', ...rest);\nexport const td = (...rest) => _el('td', ...rest);\n\nexport const span = (...rest) => _el('span', ...rest);\nexport const a = (...rest) => _el('a', ...rest);\nexport const em = (...rest) => _el('em', ...rest);\nexport const strong = (...rest) => _el('strong', ...rest);\nexport const mark = (...rest) => _el('mark', ...rest);\n\nexport const input = (...rest) => _el('input', { type: 'text' }, ...rest);\nexport const button = (...rest) => _el('button', ...rest);\nexport const text = input;\nexport const textarea = (...rest) => _el('textarea', ...rest);\nexport const checkbox = (...rest) =>\n  _el('input', { type: 'checkbox' }, ...rest);\nexport const radio = (...rest) => _el('input', { type: 'radio' }, ...rest);\nexport const select = (...rest) => _el('select', ...rest);\nexport const option = (...rest) => _el('option', ...rest);\nexport const file = (...rest) => _el('input', { type: 'file' }, ...rest);\n\nexport const br = (...rest) => _el('br', ...rest);\nexport const hr = (...rest) => _el('hr', ...rest);\n\n/**\n * Replaces the entire contents of `oldNode` with `newChild`.\n * It’s generally advisable to use a `DocumentFragment` for the\n * the replacement.\n *\n * @param {Node} oldNode\n * @param {Node|DocumentFragment|NodeList|Array<Node>} newChild\n * @returns {Node}  - The new parent wrapper\n */\nexport function replaceChildren(oldNode, newChild) {\n  if (!oldNode) return;\n  const tmpParent = oldNode.cloneNode();\n  if (newChild) {\n    if (newChild instanceof Node) {\n      tmpParent.appendChild(newChild);\n    } else {\n      Array.prototype.forEach.call(newChild, child =>\n        tmpParent.appendChild(child)\n      );\n    }\n  }\n  oldNode.parentNode.replaceChild(tmpParent, oldNode);\n  return tmpParent;\n}\n","export function myAnnotations(state) {\n  if (!state.ui.user) return [];\n  return state.model.annotations.filter(a => state.ui.user === a.user);\n}\nexport function annotationByID(state, id) {\n  return state.model.annotations.find(a => id === a.id);\n}\n/**\n * Whether an annotation is owned by the current user.\n *\n * @param {Object} state\n * @param {string} id\n * @return {boolean}\n */\nexport function isMyAnnotation(state, id) {\n  return state.model.annotations.some(\n    a => id === a.id && state.ui.user === a.user\n  );\n}\nexport function upsertAnnotation(state, annotation) {\n  if (!annotation) throw new ReferenceError(`Missing annotation`);\n  if (!annotation.id) throw new ReferenceError(`Missing annotation.id`);\n\n  const annotations = state.model.annotations;\n  const arr = [...annotations];\n  const existingIndex = arr.findIndex(a => annotation.id === a.id);\n  if (existingIndex > -1) {\n    arr.splice(existingIndex, 1);\n  }\n  arr.push({\n    ...annotation,\n    timestamp: new Date().toISOString(),\n    isDirty: undefined,\n  });\n\n  const documentOrder = (a, b) => {\n    if (a.range.start.line > b.range.start.line) return true;\n    if (a.range.start.line === b.range.start.line) {\n      return a.range.start.column > b.range.start.column;\n    }\n    return false;\n  };\n  return {\n    ...state,\n    model: {\n      ...state.model,\n      annotations: arr.sort(documentOrder),\n    },\n  };\n}\nexport function deleteAnnotation(state, id) {\n  const arr = [...state.model.annotations];\n  const existingIndex = arr.findIndex(a => id === a.id);\n  if (existingIndex > -1) {\n    arr.splice(existingIndex, 1);\n  }\n  return arr;\n}\n\n/**\n *\n *\n * @param {string} content - `model.content`\n * @param {Array<Annotation*>} annotations - `model.annotations`\n * @return {string}\n */\nexport function serializeAnnotatedMarkdown(content, annotations = []) {\n  const serializedAnnotations = serializeAnnotations(annotations);\n  return (\n    content +\n    ('' === serializedAnnotations ? '' : '\\n\\n' + serializedAnnotations)\n  );\n}\nserializeAnnotatedMarkdown.NAMESPACE = 'http://marklogic.com/annotations';\n\n/**\n * Serialize annotations as JSON in a Markdown comment.\n *\n * @param {Array<Annotation*>} annotations\n * @return {string} - Markdown comment wrapping serialized JSON\n */\nfunction serializeAnnotations(annotations) {\n  if (!annotations || 0 === annotations.length) {\n    return '';\n  }\n  const annotationsJSON = JSON.stringify(annotations, null, 2);\n  return `<!--- ${serializeAnnotatedMarkdown.NAMESPACE}\\n\\n${\n    annotationsJSON\n  }\\n\\n--->`;\n}\n","import { isMyAnnotation, annotationByID } from './selectors.js';\n\nexport const USER_LOGIN = 'USER_LOGIN';\nexport const DOCUMENT_LOAD = 'DOCUMENT_LOAD';\nexport const SELECTION_CHANGE = 'SELECTION_CHANGE';\nexport const SELECTION_CANCEL = 'SELECTION_CANCEL';\nexport const ANNOTATION_CREATE = 'ANNOTATION_CREATE';\nexport const ANNOTATION_SELECT = 'ANNOTATION_SELECT';\nexport const ANNOTATION_EDIT_BEGIN = 'ANNOTATION_EDIT_BEGIN';\nexport const ANNOTATION_EDIT_CHANGE = 'ANNOTATION_EDIT_CHANGE';\nexport const ANNOTATION_EDIT_CANCEL = 'ANNOTATION_EDIT_CHANGE';\nexport const ANNOTATION_SAVE_RECEIPT = 'ANNOTATION_SAVE';\n\n// TODO: Async?\nexport function login(user) {\n  return {\n    type: USER_LOGIN,\n    user,\n  };\n}\n/**\n *\n * @param {string} content\n * @param {string} mime = 'text/markdown'\n * @return {Action}\n */\nexport function documentLoad(\n  { content, annotations },\n  href,\n  mime = 'text/markdown'\n) {\n  // console.log('documentLoad', content, annotations, href, mime);\n  return {\n    type: DOCUMENT_LOAD,\n    content,\n    annotations,\n    href,\n    mime,\n  };\n}\nexport function annotationSelect(id) {\n  return {\n    type: ANNOTATION_SELECT,\n    id,\n  };\n}\n\n// <https://stackoverflow.com/a/2117523/563324>\nfunction uuidv4() {\n  return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>\n    (\n      c ^\n      (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (c / 4)))\n    ).toString(16)\n  );\n}\n\nexport function annotationCreate(user, selection) {\n  const id = uuidv4();\n  return (dispatch, getState) => {\n    console.log('annotationCreate');\n    dispatch({\n      type: ANNOTATION_CREATE,\n      annotation: {\n        isDirty: true,\n        id,\n        timestamp: null,\n        user: user,\n        comment: '',\n        range: {\n          start: {\n            line: selection.start.line,\n            column: selection.start.column,\n          },\n          end: {\n            line: selection.end.line,\n            column: selection.end.column,\n          },\n        },\n      },\n    });\n    dispatch(annotationSelect(id));\n    dispatch(editActiveAnnotation());\n  };\n}\n\nexport function editActiveAnnotation() {\n  return (dispatch, getState) => {\n    if (isMyAnnotation(getState(), getState().ui.activeAnnotationID)) {\n      dispatch({\n        type: ANNOTATION_EDIT_BEGIN,\n        isEditing: true,\n      });\n    }\n  };\n}\n\nexport function cancelEditActiveAnnotation() {\n  return (dispatch, getState) => {\n    if (getState().ui.activeAnnotationID && getState().ui.isEditing) {\n      dispatch({\n        type: ANNOTATION_EDIT_CANCEL,\n        isEditing: false,\n      });\n    }\n  };\n}\n\nfunction getUser(state) {\n  return state.ui.user;\n}\n\nexport function saveAnnotation(id, comment) {\n  console.log('saveAnnotation', id, comment);\n  return (dispatch, getState) => {\n    const state = getState();\n    if (\n      id === state.ui.activeAnnotationID &&\n      isMyAnnotation(state, state.ui.activeAnnotationID)\n    ) {\n      dispatch({\n        type: ANNOTATION_SAVE_RECEIPT,\n        annotation: {\n          ...annotationByID(state, id),\n          comment,\n          timestamp: new Date().toISOString(),\n        },\n      });\n    }\n  };\n}\n","import {\n  USER_LOGIN,\n  DOCUMENT_LOAD,\n  SELECTION_CHANGE,\n  SELECTION_CANCEL,\n  ANNOTATION_CREATE,\n  ANNOTATION_SELECT,\n  ANNOTATION_EDIT_BEGIN,\n  ANNOTATION_EDIT_CHANGE,\n  ANNOTATION_EDIT_CANCEL,\n  ANNOTATION_SAVE_RECEIPT,\n} from './actions.js';\n\nimport { upsertAnnotation } from './selectors.js';\n\nconst { create, assign } = Object;\n\nfunction shallowCopy(input, ...others) {\n  if (Array.isArray(input)) return [...input];\n  switch (typeof input) {\n    case 'object':\n      return assign(create(null), input, ...others);\n    default:\n      return input;\n  }\n}\n\nconst INITIAL_STATE = shallowCopy({\n  ui: {\n    user: null,\n    currentSelection: null,\n    activeAnnotationID: null,\n    isEditing: null,\n    isRendering: null,\n  },\n  model: { content: null, href: null, annotations: [] },\n});\n\n/**\n *\n * @param {Object} state\n * @param {Object} action\n * @return {Object}\n */\nexport function reducer(state = INITIAL_STATE, action) {\n  switch (action.type) {\n    case USER_LOGIN:\n      return login(state, action);\n    case DOCUMENT_LOAD:\n      return documentLoad(state, action);\n    case SELECTION_CHANGE:\n      return {\n        ...state,\n        ui: {\n          ...state.ui,\n          selection: action.selection,\n          position: action.position,\n        },\n      };\n    case SELECTION_CANCEL: {\n      const ui = { ...state.ui };\n      delete ui.selection;\n      delete ui.position;\n      return {\n        ...state,\n        ui,\n      };\n    }\n    case ANNOTATION_CREATE: {\n      const ui = {\n        ...state.ui,\n      };\n      delete ui.position;\n      delete ui.selection;\n      return {\n        ...upsertAnnotation(state, action.annotation),\n        ui,\n      };\n    }\n    case ANNOTATION_SELECT:\n      // const ui = shallowCopy(state.ui, { activeAnnotationID: action.id });\n      // return shallowCopy(state, { ui });\n      return {\n        ...state,\n        ui: {\n          ...state.ui,\n          activeAnnotationID: action.id,\n          isEditing: false,\n        },\n      };\n    case ANNOTATION_EDIT_BEGIN:\n      return {\n        ...state,\n        ui: {\n          ...state.ui,\n          isEditing: action.isEditing,\n        },\n      };\n    case ANNOTATION_EDIT_BEGIN:\n    case ANNOTATION_EDIT_CANCEL:\n      return {\n        ...state,\n        ui: {\n          ...state.ui,\n          isEditing: action.isEditing,\n        },\n      };\n    case ANNOTATION_SAVE_RECEIPT:\n      return upsertAnnotation(state, action.annotation);\n    default:\n      return state;\n  }\n}\n/** @private */\nfunction login(state, action) {\n  const ui = shallowCopy(state.ui, { user: action.user });\n  return shallowCopy(state, { ui });\n}\n\n// TODO: This probably needs to happen async\nfunction documentLoad(state, action) {\n  const model = shallowCopy(state.model, {\n    content: action.content,\n    annotations: action.annotations,\n    href: action.href,\n    mime: action.mime,\n  });\n  return shallowCopy(state, { model });\n}\n","/**\n * BKDR Hash (modified version)\n *\n * @param {String} str string to hash\n * @returns {Number}\n */\nvar BKDRHash = function(str) {\n    var seed = 131;\n    var seed2 = 137;\n    var hash = 0;\n    // make hash more sensitive for short string like 'a', 'b', 'c'\n    str += 'x';\n    // Note: Number.MAX_SAFE_INTEGER equals 9007199254740991\n    var MAX_SAFE_INTEGER = parseInt(9007199254740991 / seed2);\n    for(var i = 0; i < str.length; i++) {\n        if(hash > MAX_SAFE_INTEGER) {\n            hash = parseInt(hash / seed2);\n        }\n        hash = hash * seed + str.charCodeAt(i);\n    }\n    return hash;\n};\n\nmodule.exports = BKDRHash;\n","var BKDRHash = require('./bkdr-hash');\n\n/**\n * Convert RGB Array to HEX\n *\n * @param {Array} RGBArray - [R, G, B]\n * @returns {String} 6 digits hex starting with #\n */\nvar RGB2HEX = function(RGBArray) {\n    var hex = '#';\n    RGBArray.forEach(function(value) {\n        if (value < 16) {\n            hex += 0;\n        }\n        hex += value.toString(16);\n    });\n    return hex;\n};\n\n/**\n * Convert HSL to RGB\n *\n * @see {@link http://zh.wikipedia.org/wiki/HSL和HSV色彩空间} for further information.\n * @param {Number} H Hue ∈ [0, 360)\n * @param {Number} S Saturation ∈ [0, 1]\n * @param {Number} L Lightness ∈ [0, 1]\n * @returns {Array} R, G, B ∈ [0, 255]\n */\nvar HSL2RGB = function(H, S, L) {\n    H /= 360;\n\n    var q = L < 0.5 ? L * (1 + S) : L + S - L * S;\n    var p = 2 * L - q;\n\n    return [H + 1/3, H, H - 1/3].map(function(color) {\n        if(color < 0) {\n            color++;\n        }\n        if(color > 1) {\n            color--;\n        }\n        if(color < 1/6) {\n            color = p + (q - p) * 6 * color;\n        } else if(color < 0.5) {\n            color = q;\n        } else if(color < 2/3) {\n            color = p + (q - p) * 6 * (2/3 - color);\n        } else {\n            color = p;\n        }\n        return Math.round(color * 255);\n    });\n};\n\n/**\n * Color Hash Class\n *\n * @class\n */\nvar ColorHash = function(options) {\n    options = options || {};\n\n    var LS = [options.lightness, options.saturation].map(function(param) {\n        param = param || [0.35, 0.5, 0.65]; // note that 3 is a prime\n        return Object.prototype.toString.call(param) === '[object Array]' ? param.concat() : [param];\n    });\n\n    this.L = LS[0];\n    this.S = LS[1];\n\n    this.hash = options.hash || BKDRHash;\n};\n\n/**\n * Returns the hash in [h, s, l].\n * Note that H ∈ [0, 360); S ∈ [0, 1]; L ∈ [0, 1];\n *\n * @param {String} str string to hash\n * @returns {Array} [h, s, l]\n */\nColorHash.prototype.hsl = function(str) {\n    var H, S, L;\n    var hash = this.hash(str);\n\n    H = hash % 359; // note that 359 is a prime\n    hash = parseInt(hash / 360);\n    S = this.S[hash % this.S.length];\n    hash = parseInt(hash / this.S.length);\n    L = this.L[hash % this.L.length];\n\n    return [H, S, L];\n};\n\n/**\n * Returns the hash in [r, g, b].\n * Note that R, G, B ∈ [0, 255]\n *\n * @param {String} str string to hash\n * @returns {Array} [r, g, b]\n */\nColorHash.prototype.rgb = function(str) {\n    var hsl = this.hsl(str);\n    return HSL2RGB.apply(this, hsl);\n};\n\n/**\n * Returns the hash in hex\n *\n * @param {String} str string to hash\n * @returns {String} hex with #\n */\nColorHash.prototype.hex = function(str) {\n    var rgb = this.rgb(str);\n    return RGB2HEX(rgb);\n};\n\nmodule.exports = ColorHash;\n","import { div, span, button, empty } from './dom-helper.js';\nimport ColorHash from 'color-hash';\n\nexport default function render(user, withLogout = false) {\n  if (!user) return empty();\n  const style = {\n    backgroundColor: `rgba(${new ColorHash().rgb(user).join(', ')}, 0.5)`,\n  };\n  return div(\n    { className: 'user' },\n    span({ className: 'user-color' }, { style }),\n    span(user),\n    withLogout\n      ? button('Logout', {\n          id: 'Logout',\n          onclick: evt => console.log('logout'),\n        })\n      : empty()\n  );\n}\n","// <https://jsfiddle.net/gabrieleromanato/qAGHT/>\nconst _keyStr =\n  'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n\nexport function encode(input) {\n  var output = '';\n  var chr1, chr2, chr3, enc1, enc2, enc3, enc4;\n  var i = 0;\n\n  input = _utf8_encode(input);\n\n  while (i < input.length) {\n    chr1 = input.charCodeAt(i++);\n    chr2 = input.charCodeAt(i++);\n    chr3 = input.charCodeAt(i++);\n\n    enc1 = chr1 >> 2;\n    enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\n    enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\n    enc4 = chr3 & 63;\n\n    if (isNaN(chr2)) {\n      enc3 = enc4 = 64;\n    } else if (isNaN(chr3)) {\n      enc4 = 64;\n    }\n\n    output =\n      output +\n      _keyStr.charAt(enc1) +\n      _keyStr.charAt(enc2) +\n      _keyStr.charAt(enc3) +\n      _keyStr.charAt(enc4);\n  }\n\n  return output;\n}\n\nexport function decode(input) {\n  var output = '';\n  var chr1, chr2, chr3;\n  var enc1, enc2, enc3, enc4;\n  var i = 0;\n\n  input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, '');\n\n  while (i < input.length) {\n    enc1 = _keyStr.indexOf(input.charAt(i++));\n    enc2 = _keyStr.indexOf(input.charAt(i++));\n    enc3 = _keyStr.indexOf(input.charAt(i++));\n    enc4 = _keyStr.indexOf(input.charAt(i++));\n\n    chr1 = (enc1 << 2) | (enc2 >> 4);\n    chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n    chr3 = ((enc3 & 3) << 6) | enc4;\n\n    output = output + String.fromCharCode(chr1);\n\n    if (enc3 != 64) {\n      output = output + String.fromCharCode(chr2);\n    }\n    if (enc4 != 64) {\n      output = output + String.fromCharCode(chr3);\n    }\n  }\n\n  output = _utf8_decode(output);\n\n  return output;\n}\n\nfunction _utf8_encode(string) {\n  string = string.replace(/\\r\\n/g, '\\n');\n  var utftext = '';\n\n  for (var n = 0; n < string.length; n++) {\n    var c = string.charCodeAt(n);\n\n    if (c < 128) {\n      utftext += String.fromCharCode(c);\n    } else if (c > 127 && c < 2048) {\n      utftext += String.fromCharCode((c >> 6) | 192);\n      utftext += String.fromCharCode((c & 63) | 128);\n    } else {\n      utftext += String.fromCharCode((c >> 12) | 224);\n      utftext += String.fromCharCode(((c >> 6) & 63) | 128);\n      utftext += String.fromCharCode((c & 63) | 128);\n    }\n  }\n\n  return utftext;\n}\n\nfunction _utf8_decode(utftext) {\n  var string = '';\n  var i = 0;\n  var c = (c1 = c2 = 0);\n\n  while (i < utftext.length) {\n    c = utftext.charCodeAt(i);\n\n    if (c < 128) {\n      string += String.fromCharCode(c);\n      i++;\n    } else if (c > 191 && c < 224) {\n      c2 = utftext.charCodeAt(i + 1);\n      string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\n      i += 2;\n    } else {\n      c2 = utftext.charCodeAt(i + 1);\n      c3 = utftext.charCodeAt(i + 2);\n      string += String.fromCharCode(\n        ((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63)\n      );\n      i += 3;\n    }\n  }\n\n  return string;\n}\n","import { a, empty } from './dom-helper.js';\nimport * as Base64 from './base64.js';\nimport { serializeAnnotatedMarkdown } from './selectors.js';\n\nexport default function render(content, annotations, fileName, mime) {\n  if (content && content.length > 0) {\n    const href = `data:${mime};charset=utf-8;base64,${Base64.encode(\n      serializeAnnotatedMarkdown(content, annotations)\n    )}`;\n    return a('Download', {\n      href,\n      download: decodeURIComponent(fileName.split('/').pop()),\n    });\n  }\n  return empty();\n}\n","import { h1, toFragment } from './dom-helper.js';\nimport { default as User } from './user.js';\nimport { default as Download } from './download.js';\n\nexport default function render(model, ui, dispatcher) {\n  return toFragment(\n    h1(\n      model.href,\n      Download(model.content, model.annotations, model.href, model.mime)\n    ),\n    User(ui.user, true)\n  );\n}\n","import { table, tbody, tr, td, empty } from './dom-helper.js';\n\nfunction lineProps(line) {\n  const props = {};\n\n  const listMatcher = /^(\\s*)(\\*|\\-|\\d+\\.|>) /; // matches list items and quotes\n  const matches = line.match(listMatcher);\n  if (matches) {\n    const indent = matches[1].length + matches[2].length + 1;\n    props.style = {\n      ...props.style,\n      paddingLeft: `${indent}ch`,\n      textIndent: `-${indent}ch`,\n    };\n  }\n\n  const headingMatcher = /^#+ /;\n  if (line.match(headingMatcher)) {\n    // content.classList.add('heading');\n    props.classList = [...(props.classList || []), 'heading'];\n  }\n\n  const quoteMatcher = /^>+ /;\n  if (line.match(quoteMatcher)) {\n    // content.classList.add('quote');\n    props.classList = [...(props.classList || []), 'quote'];\n  }\n\n  return props;\n}\n/**\n * Pass-through console logger\n *\n * @param {*} item\n * @param {string} [name = 'log']\n * @param {boolean} show\n * @return {*} - `item`\n */\nfunction log(item, name = 'log', show = true) {\n  if (show) console.log(name, item);\n  return item;\n}\n/**\n * Renders Markdown string as HTML table rows. Does not touch the live DOM.\n *\n * @param {string} md  - Markdown\n * @returns {HTMLTableElement|DocumentFragment}\n */\nexport default function renderMarkdown(md) {\n  if (!md) return empty();\n\n  return table(\n    tbody(\n      md.split(/\\n/).map((line, index) =>\n        tr(\n          td('', { className: 'line-number', dataset: { line: index + 1 } }),\n          td(\n            '' === line ? '\\n' : line,\n            { className: 'content' },\n            lineProps(line)\n          ),\n          {\n            id: `L${index + 1}`,\n            className: 'line',\n            dataset: { line: index + 1 },\n          }\n        )\n      )\n    )\n  );\n}\n","import { file } from './dom-helper.js';\nimport { documentLoad } from './actions.js';\nimport Markdown from './markdown.js';\n\nexport default function render(model, ui, dispatch) {\n  if (model.content) {\n    document.title = `Annotating ${model.href}`;\n    return Markdown(model.content);\n  }\n  // <input type=\"file\" id=\"Upload\" accept=\"text/markdown\" />\n  return file({\n    id: 'Upload',\n    accept: 'text/markdown',\n    onchange: evt => {\n      const file = evt.target.files[0];\n      const reader = new FileReader();\n      reader.addEventListener('load', () => {\n        dispatch(\n          documentLoad(parseAnnotatedMarkdown(reader.result), file.name)\n        );\n      });\n      reader.readAsText(file);\n    },\n  });\n}\n\n/**\n * Converse of `serializeAnnotatedMarkdown()`.\n *\n * @param {string} rawMarkdown - a string of Markdown with an optional\n *                               block of annotations serialized as JSON\n * @return {Object} - `{ content: string, annotations: Array<Annotation*> }`\n */\nfunction parseAnnotatedMarkdown(rawMarkdown) {\n  if (!rawMarkdown) return;\n  // const NAMESPACE = 'http://marklogic.com/annotations'.replace(/\\//g, '\\\\/');\n  const matcher = /([\\s\\S]+)\\n\\n<!--- http:\\/\\/marklogic.com\\/annotations\\n\\n([\\s\\S]+)\\n\\n--->([\\s\\S]*)/;\n  const matches = rawMarkdown.match(matcher);\n  if (null === matches) return { content: rawMarkdown, annotations: [] };\n  if (4 !== matches.length) {\n    throw new Error(matches.length);\n  }\n  return {\n    content: matches[1] + matches[3],\n    annotations: JSON.parse(matches[2]),\n  };\n}\n","var highlightRange = (function () {\n// Wrap each text node in a given DOM Range with an inline node , defaulting to <span class=[highLightClass]>.\n// Breaks start and/or end node if needed.\n// Returns a function that cleans up the created highlight (not a perfect undo: split text nodes are not merged again).\n//\n// Parameters:\n// - rangeObject: a Range whose start and end containers are text nodes.\n// - highlightTemplate\n//     string: the CSS class the text pieces in the range should get, defaults to 'highlighted-range'\n//     HTMLElement: an element that will be cloned for each highlight\n//     function: a function that creates a wrapper node. It's passed the Node that's being\n//               highligted and the zero-based index of the current portion of the highlight. \n//               This can be used to apply properties to a logical highlight, even if it's \n//               spread over many elements, for example to store an annotation identifier to \n//               be able to query for all highlight spans for the same annotation:\n//               \n//                 function renderAnnotation(annotation, range) {\n//                   highlightRange(range, function(node, index) {\n//                     var span = document.createElement('span');\n//                     span.classList.add('annotation');\n//                     span.dataset.annotationId = annotation.id;\n//                     return span;\n//                   });\n//                 }\nfunction highlightRange(rangeObject, highlightTemplate) {\n    // Ignore range if empty.\n    if (rangeObject.collapsed) {\n        return;\n    }\n\n    var highlightCallback = calculateHighlightCallback(highlightTemplate);\n\n    // First put all nodes in an array (splits start and end nodes)\n    var nodes = textNodesInRange(rangeObject);\n\n    // Remember range details to restore it later.\n    var startContainer = rangeObject.startContainer;\n    var startOffset = rangeObject.startOffset;\n    var endContainer = rangeObject.endContainer;\n    var endOffset = rangeObject.endOffset;\n\n    // Highlight each node\n    var highlights = [];\n    for (var nodeIdx in nodes) {\n        highlights.push(highlightNode(nodes[nodeIdx], nodeIdx, highlightCallback));\n    }\n\n    // The rangeObject gets messed up by our DOM changes. Be kind and restore.\n    rangeObject.setStart(startContainer, startOffset);\n    rangeObject.setEnd(endContainer, endOffset);\n\n    // Return a function that cleans up the highlights.\n    function cleanupHighlights() {\n        // Remember range details to restore it later.\n        var startContainer = rangeObject.startContainer;\n        var startOffset = rangeObject.startOffset;\n        var endContainer = rangeObject.endContainer;\n        var endOffset = rangeObject.endOffset;\n\n        // Remove each of the created highlights.\n        for (var highlightIdx in highlights) {\n            removeHighlight(highlights[highlightIdx]);\n        }\n\n        // Be kind and restore the rangeObject again.\n        rangeObject.setStart(startContainer, startOffset);\n        rangeObject.setEnd(endContainer, endOffset);\n    }\n    return cleanupHighlights;\n}\n\n/**\n * Figure out which factory function callback to use to create a highlight Node.\n * \n * @param {string|function|HTMLElement} highlightTemplate\n * @return {function} - a function that will be used to construct a highlight Node\n * @throws {TypeError}\n * @private\n */\nfunction calculateHighlightCallback(highlightTemplate) {\n    if ('function' === typeof highlightTemplate) return highlightTemplate;\n    if (highlightTemplate instanceof HTMLElement) {\n        return function _highlightTemplateHTMLElement() {\n            return highlightTemplate.cloneNode();\n        };\n    }\n    if ('string' === typeof highlightTemplate) {\n        return function _highlightTemplateClassName() {\n            var span = document.createElement('span');\n            span.classList.add(highlightTemplate);\n            return span;\n        }\n    }\n    if(undefined === highlightTemplate) {\n        return calculateHighlightCallback('highlighted-range');\n    }\n    var msg = 'highlightTemplate must be a string, an HTMLElement, a function, or undefined: ' + typeof highlightTemplate;\n    throw new TypeError(msg);\n}\n\n// Return an array of the text nodes in the range. Split the start and end nodes if required.\nfunction textNodesInRange(rangeObject) {\n    // Modify Range to make sure that the start and end nodes are text nodes.\n    setRangeToTextNodes(rangeObject);\n\n    var nodes = [];\n\n    // Ignore range if empty.\n    if (rangeObject.collapsed) {\n        return nodes;\n    }\n\n    // Include (part of) the start node if needed.\n    if (rangeObject.startOffset != rangeObject.startContainer.length) {\n        // If only part of the start node is in the range, split it.\n        if (rangeObject.startOffset != 0) {\n            // Split startContainer to turn the part after the startOffset into a new node.\n            var createdNode = rangeObject.startContainer.splitText(rangeObject.startOffset);\n\n            // If the end was in the same container, it will now be in the newly created node.\n            if (rangeObject.endContainer === rangeObject.startContainer) {\n                rangeObject.setEnd(createdNode, rangeObject.endOffset - rangeObject.startOffset);\n            }\n\n            // Update the start node, which no longer has an offset.\n            rangeObject.setStart(createdNode, 0);\n        }\n    }\n\n    // Create an iterator to iterate through the nodes.\n    var root = (typeof rangeObject.commonAncestorContainer != 'undefined')\n               ? rangeObject.commonAncestorContainer\n               : document.body; // fall back to whole document for browser compatibility\n    var iter = document.createNodeIterator(root, NodeFilter.SHOW_TEXT);\n\n    // Find the start node (could we somehow skip this seemingly needless search?)\n    while (iter.referenceNode !== rangeObject.startContainer && iter.referenceNode !== null) {\n        iter.nextNode();\n    }\n\n    // Add each node up to (but excluding) the end node.\n    while (iter.referenceNode !== rangeObject.endContainer && iter.referenceNode !== null) {\n        nodes.push(iter.referenceNode);\n        iter.nextNode();\n    }\n\n    // Include (part of) the end node if needed.\n    if (rangeObject.endOffset != 0) {\n\n        // If it is only partly included, we need to split it up.\n        if (rangeObject.endOffset != rangeObject.endContainer.length) {\n            // Split the node, breaking off the part outside the range.\n            rangeObject.endContainer.splitText(rangeObject.endOffset);\n            // Note that the range object need not be updated.\n\n            //assert(rangeObject.endOffset == rangeObject.endContainer.length);\n        }\n\n        // Add the end node.\n        nodes.push(rangeObject.endContainer);\n    }\n\n    return nodes;\n}\n\n\n// Normalise the range to start and end in a text node.\n// Copyright (c) 2015 Randall Leeds\nfunction setRangeToTextNodes(rangeObject) {\n    function getFirstTextNode(node) {\n        if (node.nodeType === Node.TEXT_NODE) return node;\n        var document = node.ownerDocument;\n        var walker = document.createTreeWalker(node, NodeFilter.SHOW_TEXT, null, false);\n        return walker.firstChild();\n    }\n\n    var startNode = rangeObject.startContainer;\n    var startOffset = rangeObject.startOffset;\n\n    // Drill down to a text node if the range starts at the container boundary.\n    if (startNode.nodeType !== Node.TEXT_NODE) {\n        if (startOffset === startNode.childNodes.length) {\n            startNode = startNode.childNodes[startOffset - 1];\n            startNode = getFirstTextNode(startNode);\n            startOffset = startNode.textContent.length;\n        } else {\n            startNode = startNode.childNodes[startOffset];\n            startNode = getFirstTextNode(startNode);\n            startOffset = 0;\n        }\n        rangeObject.setStart(startNode, startOffset);\n    }\n\n    var endNode = rangeObject.endContainer;\n    var endOffset = rangeObject.endOffset;\n\n    // Drill down to a text node if the range ends at the container boundary.\n    if (endNode.nodeType !== Node.TEXT_NODE) {\n        if (endOffset === endNode.childNodes.length) {\n            endNode = endNode.childNodes[endOffset - 1];\n            endNode = getFirstTextNode(endNode);\n            endOffset = endNode.textContent.length;\n        } else {\n            endNode = endNode.childNodes[endOffset];\n            endNode = getFirstTextNode(endNode);\n            endOffset = 0;\n        }\n        rangeObject.setEnd(endNode, endOffset);\n    }\n}\n\n\n// Replace [node] with a constructed node</span>\nfunction highlightNode(node, index, highlightCallback) {\n    // Create a highlight\n    var highlight  = highlightCallback(node, index);\n\n    // Wrap it around the text node\n    node.parentNode.replaceChild(highlight, node);\n    highlight.appendChild(node);\n\n    return highlight;\n}\n\n\n// Remove a highlight <span> created with highlightNode.\nfunction removeHighlight(highlight) {\n    // Move its children (normally just one text node) into its parent.\n    while (highlight.firstChild) {\n        highlight.parentNode.insertBefore(highlight.firstChild, highlight);\n    }\n    // Remove the now empty node\n    highlight.remove();\n}\n\nreturn highlightRange;\n})();\n\nif (typeof module !== 'undefined') {\n    module.exports = highlightRange;\n}\n","import {\n  SELECTION_CHANGE,\n  SELECTION_CANCEL,\n  annotationCreate,\n} from './actions.js';\nimport { div, button } from './dom-helper.js';\nimport { onComponentDidMount } from './component.js';\n\nlet isInitialized = false;\n\nexport default function render(\n  position,\n  selection,\n  user,\n  dispatch,\n  getSelection\n) {\n  if (!isInitialized) {\n    initialize(dispatch, getSelection);\n    isInitialized = true;\n  }\n\n  const style = { position: 'absolute' };\n  if (position) {\n    style.display = 'unset';\n    style.top = `${position.y}px`;\n    style.left = `${position.x}px`;\n    restoreSelection(selection);\n  } else {\n    style.display = 'none';\n    style.top = `-100px`;\n    style.left = `-100px`;\n  }\n  const b = button('🖍', {\n    onclick: evt => dispatch(annotationCreate(user, getSelection())),\n  });\n  return div({ style, [onComponentDidMount]: () => b.focus() }, b);\n}\n\nfunction restoreSelection(range) {\n  if (!range) return;\n  const r = rangeFromOffsets(\n    document.querySelector(`#L${range.start.line}>td.content`),\n    range.start.column,\n    document.querySelector(`#L${range.end.line}>td.content`),\n    range.end.column\n  );\n  const selection = window.getSelection();\n  selection.removeAllRanges();\n  selection.addRange(r);\n}\n\nfunction initialize(dispatch, getSelection) {\n  let isSelecting = false;\n\n  document.addEventListener('selectionchange', evt => {\n    isSelecting = !window.getSelection().isCollapsed;\n  });\n\n  document.addEventListener('mouseup', evt => {\n    // FIXME: UGLY!\n    if ('BUTTON' === evt.target.nodeName) {\n      evt.preventDefault();\n      return;\n    }\n    if (isSelecting) {\n      dispatch({\n        type: SELECTION_CHANGE,\n        selection: getRange(window.getSelection()),\n        position: { x: evt.pageX, y: evt.pageY },\n      });\n      isSelecting = false;\n    } else {\n      if (getSelection()) {\n        dispatch({ type: SELECTION_CANCEL });\n      }\n    }\n  });\n}\n\n/**\n * The number of characters from the start of the parent node\n * to the child node, flattening all intervening children,\n * plus the offset in the child node.\n *\n * @example <div>ab<a>cd<a>ef</a>f</a>gh</div>\n *          textOffsetFromNode(div, a[1], 1) // 5 = 'ab' + 'cd' + 1\n *\n * @param {Node} parent\n * @param {Node} child\n * @param {number} [childOffset = 0]\n */\nfunction textOffsetFromNode(parent, child, childOffset = 0) {\n  if (!parent) return;\n  if (!child) return offset;\n  // console.log('textOffsetFromNode', parent, child, childOffset);\n  const iter = document.createNodeIterator(parent, NodeFilter.SHOW_TEXT);\n\n  let node;\n  let offset = 0;\n  while (iter.nextNode()) {\n    node = iter.referenceNode;\n    if (node === child) {\n      return offset + childOffset;\n    }\n    if (Node.TEXT_NODE === node.nodeType) {\n      offset += node.textContent.length;\n    }\n  }\n  throw new Error(\n    `Couldn’t find ${String(child)} as a child of ${String(parent)}`\n  );\n}\n\n/**\n * Given a node, find its parent line number,\n * delegating to `getLine()`.\n *\n * @param {Node} node\n * @param {string} [matcher = 'tr.line']\n * @return {number}\n */\nfunction getLineNumber(node, matcher = 'tr.line') {\n  return parseInt(getLine(node, matcher).dataset.line, 10);\n}\n\n/**\n * Given a node, find its parent line.\n *\n * @param {Node} node\n * @param {string} [matcher = 'tr.line']\n */\nfunction getLine(node, matcher = 'tr.line') {\n  do {\n    if (node.matches && node.matches(matcher)) {\n      return node;\n    }\n  } while ((node = node.parentNode));\n  return undefined;\n}\n\n/**\n * Given a `Selection`, determine the `Range`, where\n * `start` is always before `end`, regardless\n * from which direction the selection was made.\n *\n * @param {Selection} selection\n * @returns {Object} - `{ start: number, end: number };\n */\nfunction getRange(selection) {\n  if (!selection) return;\n  if (!(selection instanceof Selection))\n    throw new TypeError(String(selection.constructor.name));\n\n  const anchor = {\n    line: getLineNumber(selection.anchorNode),\n    column: textOffsetFromNode(\n      getLine(selection.anchorNode),\n      selection.anchorNode,\n      selection.anchorOffset\n    ),\n  };\n  const focus = {\n    line: getLineNumber(selection.focusNode),\n    column: textOffsetFromNode(\n      getLine(selection.focusNode),\n      selection.focusNode,\n      selection.focusOffset\n    ),\n  };\n  // console.log('getRange', anchor, focus);\n  if (\n    anchor.line < focus.line ||\n    (anchor.line === focus.line && anchor.column <= focus.column)\n  ) {\n    return {\n      start: anchor,\n      end: focus,\n    };\n  } else {\n    return {\n      start: focus,\n      end: anchor,\n    };\n  }\n}\n\n/**\n *\n * @param {Node} parentStart\n * @param {number} start\n * @param {Node} parentEnd\n * @param {number} end\n * @return {Range}\n */\nexport function rangeFromOffsets(\n  parentStart,\n  start = 0,\n  parentEnd = parentStart,\n  end = 0\n) {\n  // console.log('rangeFromOffsets', parentStart, start, parentEnd, end);\n  const range = document.createRange();\n  const s = nodeFromTextOffset(parentStart, start);\n  const e = nodeFromTextOffset(parentEnd, end);\n  // console.log('rangeFromOffsets#nodeFromTextOffset', s, e);\n  range.setStart(childTextNodeOrSelf(s.node), s.offset);\n  range.setEnd(childTextNodeOrSelf(e.node), e.offset);\n\n  return range;\n}\n\n/**\n *\n * @param {Node} parent\n * @param {number} offset\n * @return {Object} - `{ node: Node, offset: number }`\n */\nfunction nodeFromTextOffset(parent, offset = 0) {\n  if (!parent) return;\n  // console.log('nodeFromTextOffset', parent, offset);\n\n  const iter = document.createNodeIterator(parent, NodeFilter.SHOW_TEXT);\n\n  let counter = -1;\n  let node;\n  let last;\n  // Find the start node (could we somehow skip this seemingly needless search?)\n  while (counter < offset && iter.nextNode()) {\n    node = iter.referenceNode;\n    if (node.nodeType === Node.TEXT_NODE) {\n      last = offset - counter - 1;\n      counter += node.textContent.length;\n    }\n  }\n  return { node: node, offset: last };\n}\n\n/**\n * Descendent-or-self until you get a `TextNode`\n *\n * @param {Node} node\n * @return {TextNode} - Or `undefined` if there are not text\n *                      children, e.g. `<br/>`\n */\nfunction childTextNodeOrSelf(node) {\n  if (!node) return;\n  if (!(node instanceof Node)) throw new TypeError(node.constructor.name);\n\n  if (Node.TEXT_NODE === node.nodeType) {\n    return node;\n  }\n  if (node.firstChild) {\n    return childTextNodeOrSelf(node.firstChild);\n  }\n  return undefined;\n}\n","import highlightRange from 'dom-highlight-range';\nimport ColorHash from 'color-hash';\nimport { annotationSelect } from './actions.js';\n// TODO: Don’t depend on another component directly.\n//       Extract the common functions into a helper library.\nimport { rangeFromOffsets } from './selection.js';\n\n/**\n * Assumes the Markdown DOM has been rendered. Works on the live DOM.\n * Probably should make this async for lots of annotations.\n *\n * @param {Array<Annotation>} annotations\n * @param {function} dispatch\n * @return {Array<{id:Node}>} - An array highlight nodes, keyed on annotation id\n */\nexport default function render(annotations, relativeY = 0, ui, dispatch) {\n  // Highlight annotations. Requires that DOM is already committed above\n  return annotations.reduce((markers, annotation) => {\n    return {\n      ...markers,\n      [annotation.id]: renderAnnotationHighlight(\n        annotation,\n        // state.model.annotations.mine().some(a => annotation.id === a.id),\n        false,\n        ui.activeAnnotationID === annotation.id,\n        relativeY,\n        dispatch\n      ),\n    };\n  }, {});\n}\n\nfunction renderAnnotationHighlight(\n  annotation,\n  isMine = false,\n  isActive = false,\n  relativeY = 0,\n  dispatch\n) {\n  if (!annotation) return;\n  const r = rangeFromOffsets(\n    document.querySelector(`#L${annotation.range.start.line}>td.content`),\n    annotation.range.start.column,\n    document.querySelector(`#L${annotation.range.end.line}>td.content`),\n    annotation.range.end.column\n  );\n  let first;\n  highlightRange(r, (node, index) => {\n    // FIXME: Fix this in highlight-range.js\n    index = parseInt(index, 10);\n\n    const mark = document.createElement('mark');\n    mark.classList.add('annotation-highlight');\n    mark.dataset.annotationId = annotation.id;\n    if (isMine) {\n      mark.classList.add('mine');\n    }\n    if (isActive) {\n      mark.classList.add('active');\n    }\n    mark.style.backgroundColor = `rgba(${new ColorHash()\n      .rgb(annotation.user)\n      .join(', ')}, 0.5)`;\n    mark.onclick = evt => {\n      dispatch(annotationSelect(evt.target.dataset.annotationId));\n    };\n    if (0 === index) first = mark;\n    return mark;\n  });\n  // The offset from the container\n  return first.getBoundingClientRect().y - relativeY;\n}\n","import { div, button, textarea, br, toFragment, empty } from './dom-helper.js';\nimport { onComponentDidMount } from './component.js';\nimport {\n  editActiveAnnotation,\n  cancelEditActiveAnnotation,\n  saveAnnotation,\n  annotationSelect,\n} from './actions.js';\nimport { default as User } from './user.js';\n\n/**\n *\n * @param {Annotation} annotation\n * @param {boolean} isEditing\n * @param {string} user\n * @param {function} dispatch\n * @return {HTMLElement}\n */\nexport default function render(\n  annotation,\n  isActive = false,\n  isEditing = false,\n  user,\n  markers,\n  dispatch\n) {\n  if (!annotation) return empty();\n\n  const props = {\n    classList: ['annotation-detail', isActive ? 'active' : undefined],\n    dataset: { annotationId: annotation.id },\n    style: { top: `${markers[annotation.id]}px` },\n    tabIndex: 0,\n    onclick: evt => {\n      if (!isActive) {\n        dispatch(annotationSelect(evt.currentTarget.dataset.annotationId));\n      }\n    },\n  };\n  const comm = { className: 'annotation-comment' };\n  const commentText = div(comm, toFormattedNodes(trim(annotation.comment)));\n  if (isActive) {\n    const commentEl = textarea(comm, annotation.comment || '', {\n      oninput: evt => console.log('textarea#input'),\n    });\n\n    return div(\n      props,\n      div(\n        { className: 'annotation-toolbar' },\n        User(annotation.user),\n        EditAffordance(annotation, isEditing, user, {\n          dispatch,\n          getComment: () => commentEl.value,\n        })\n      ),\n      div(\n        { className: 'annotation-editor' },\n        isEditing ? commentEl : commentText,\n        div(formatTimestamp(annotation.timestamp), {\n          className: 'annotation-timestamp',\n          dataset: { timestamp: annotation.timestamp },\n        })\n      ),\n      {\n        [onComponentDidMount]: () => {\n          commentEl.focus();\n        },\n      }\n    );\n  } else {\n    return div(\n      props,\n      { classList: 'collapsed' },\n      User(annotation.user),\n      commentText\n    );\n  }\n}\n\nfunction removeLast(arr) {\n  if (Array.isArray(arr)) {\n    const a = Array.from(arr);\n    a.splice(-1, 1);\n    return a;\n  }\n  return arr;\n}\n\nfunction toFormattedNodes(str) {\n  if ('string' === typeof str) {\n    return removeLast(\n      str.split(/\\n/).reduce((acc, item, index) => [...acc, item, br()], [])\n    );\n  }\n  return str;\n}\n\nfunction trim(str, length = 100, trailer = '…') {\n  if ('string' === typeof str) {\n    if (str.length > length) {\n      return str.substr(0, length) + trailer;\n    }\n  }\n  return str;\n}\n\nfunction formatTimestamp(timestamp) {\n  if (!timestamp) return timestamp;\n  if ('string' === typeof timestamp) timestamp = new Date(timestamp);\n  return timestamp.toLocaleString();\n}\n\n// function isCallable(f) {\n//   if (!f) return false;\n//   return 'function' === typeof f.call && 'function' === typeof f.apply;\n// }\n\n// function iif(bool, t, f) {\n//   if (bool) {\n//     return isCallable(t) ? t() : t;\n//   }\n//   return isCallable(f) ? f() : f;\n// }\n\nfunction EditAffordance(annotation, isEditing, user, { dispatch, getComment }) {\n  return div(\n    annotation.user === user && !isEditing\n      ? button('Edit', {\n          onclick: evt => {\n            dispatch(editActiveAnnotation());\n            // evt.stopPropagation();\n          },\n        })\n      : empty(),\n    isEditing\n      ? [\n          button('Save', {\n            onclick: evt =>\n              dispatch(saveAnnotation(annotation.id, getComment())),\n          }),\n          button('Cancel', {\n            onclick: evt => dispatch(cancelEditActiveAnnotation()),\n          }),\n        ]\n      : empty(),\n    { className: 'controls' }\n  );\n}\n","import { toFragment } from './dom-helper.js';\nimport { onComponentDidMount } from './component.js';\nimport { annotationByID } from './selectors.js';\nimport { default as AnnotationHighlights } from './annotation-highlight.js';\nimport { default as AnnotationDetail } from './annotation-detail.js';\n\nexport default function render(state, relativeY = 0, dispatcher) {\n  const annotationNodes = AnnotationHighlights(\n    state.model.annotations,\n    relativeY,\n    state.ui,\n    dispatcher\n  );\n  const annotationEls = state.model.annotations.map(annotation =>\n    AnnotationDetail(\n      annotation, //annotationByID(state, state.ui.activeAnnotationID),\n      annotation.id === state.ui.activeAnnotationID,\n      state.ui.isEditing,\n      state.ui.user,\n      annotationNodes,\n      dispatcher // https://github.com/reactjs/redux/blob/628928e3108df9725f07689e3785b5a2a226baa8/src/bindActionCreators.js#L26\n    )\n  );\n  return toFragment(annotationEls, {\n    [onComponentDidMount]: () => {\n      distributeVerically(annotationEls);\n    },\n  });\n}\n\n// <https://stackoverflow.com/a/23892252/563324>\nfunction getPosition(el) {\n  let x = 0,\n    y = 0;\n  while (el) {\n    x += el.offsetLeft - el.scrollLeft + el.clientLeft;\n    y += el.offsetTop - el.scrollTop + el.clientTop;\n    el = el.offsetParent;\n  }\n  return { x: x, y: y };\n}\nfunction getBottom(el) {\n  return getPosition(el).y + el.offsetHeight;\n}\n\nfunction distributeVerically(items, nudge = -8.5) {\n  Array.from(items).reduce((prevY, item, index) => {\n    const MAGIC = 44;\n    item.style.top =\n      Math.max(prevY - MAGIC, parseInt(item.style.top, 10)) + nudge + 'px';\n    // console.log('distributeVerically', item, {\n    //   prevY,\n    //   currentStyleTop: parseInt(item.style.top, 10),\n    //   getBottom: getBottom(item),\n    // });\n    // return Math.max(parseInt(item.style.top, 10), getBottom(item)) + nudge;\n    return getBottom(item);\n  }, 0);\n}\n\n/*\n// <https://jsfiddle.net/qubo7ajo/3/>\nconst items = distributeVerically(document.querySelectorAll('.item'));\n\nArray.from(document.querySelectorAll('.item')).forEach(item => {\n  const div = document.createElement('div');\n  div.textContent = String(item.style.top);\n  div.style.position = 'absolute';\n  div.style.top = '0';\n  div.style.right = '0';\n  div.style.background = 'red';\n  div.style.padding = '0.25em';\n  item.appendChild(div);\n});\n\nfunction distributeVerically(items) {\n  function getBottom(el) {\n    const y = el.getBoundingClientRect().y;\n    const h = el.getBoundingClientRect().height;\n    return y + h;\n  }\n  Array.from(items).reduce((prevY, item) => {\n    item.style.top = Math.max(prevY, parseInt(item.style.top, 10)) + 'px';\n    return getBottom(item);\n  }, 0);\n}\n*/\n","import { createStore, applyMiddleware } from 'redux';\nimport thunk from 'redux-thunk';\nimport { onComponentDidMount } from './component.js';\nimport { replaceChildren } from './dom-helper.js';\nimport { reducer } from './reducer.js';\nimport { login } from './actions.js';\nimport { default as _Header } from './header.js';\nimport { default as _Document } from './document.js';\nimport { default as _Annotations } from './annotations.js';\nimport { default as _Selection } from './selection.js';\n\nconst logger = store => next => action => {\n  console.log('Dispatching', action);\n  const result = next(action);\n  console.log('Next state', store.getState());\n  return result;\n};\nconst store = createStore(reducer, applyMiddleware(thunk, logger));\n\ndocument.addEventListener('DOMContentLoaded', evt => {\n  const Header = renderInto(_Header, 'header');\n  const Document = renderInto(_Document, '#Content');\n  const Annotations = renderInto(_Annotations, '#Annotations');\n  // const AnnotationDetail = renderInto(_AnnotationDetail, '#AnnotationDetail');\n  const Selection = renderInto(_Selection, '#SelectAnnotation');\n\n  store.subscribe(render);\n  const dispatcher = store.dispatch.bind(store);\n  store.dispatch(login('jmakeig'));\n\n  /**\n   * Gets its delegated renderers via closure. This has to be done at load-time\n   * to correctly bind to DOM elements.\n   */\n  function render(/**/) {\n    const state = store.getState();\n    console.time('render');\n    Header(state.model, state.ui, dispatcher);\n    Document(state.model, state.ui, dispatcher);\n    Annotations(\n      state,\n      document.querySelector('#Content').getBoundingClientRect().y,\n      dispatcher\n    );\n\n    Selection(\n      state.ui.position,\n      state.ui.selection,\n      state.ui.user,\n      dispatcher,\n      () => store.getState().ui.selection\n    );\n\n    console.timeEnd('render');\n  }\n});\n\n/**\n *\n * @param {function} renderer\n * @param {HTMLElement|string} [parent = document.body]\n * @return {function} - a function with the same signature as `renderer`\n */\nfunction renderInto(renderer, parent = document.body) {\n  if ('function' !== typeof renderer) throw new TypeError();\n  if ('string' === typeof parent) parent = document.querySelector(parent);\n  if (!(parent instanceof HTMLElement)) throw new ReferenceError();\n\n  /**\n   * Holds a reference to a parent `Node` into which to render the\n   * `Node` returned by the `renderer` function.\n   */\n  let ref = parent;\n  return function(...args) {\n    const tree = renderer(...args);\n    ref = replaceChildren(ref, tree);\n    if (tree && tree[onComponentDidMount]) {\n      tree[onComponentDidMount]();\n      // FIXME: Does this eliminate the possibility of a memory\n      //        leak with DOM expando properties?\n      delete tree[onComponentDidMount];\n    }\n    return ref;\n  };\n}\n"],"names":["Symbol","objectProto","hasOwnProperty","symToStringTag","nativeObjectToString","root","ponyfill","$$observable","onComponentDidMount","for","isIterable","item","ignoreStrings","exists","iterator","isEmpty","toIterable","oneOrMany","createElement","name","Node","document","createDocumentFragment","String","applyToElement","param","el","appendChild","createTextNode","p","Object","getOwnPropertyNames","getOwnPropertySymbols","cls","classList","add","_el","rest","toFragment","empty","div","h1","table","tbody","tr","td","span","a","button","textarea","file","type","br","replaceChildren","oldNode","newChild","tmpParent","cloneNode","prototype","forEach","call","child","parentNode","replaceChild","annotationByID","state","id","model","annotations","find","isMyAnnotation","some","ui","user","upsertAnnotation","annotation","ReferenceError","arr","existingIndex","findIndex","splice","push","Date","toISOString","undefined","documentOrder","b","range","start","line","column","sort","serializeAnnotatedMarkdown","content","serializedAnnotations","serializeAnnotations","NAMESPACE","length","annotationsJSON","JSON","stringify","USER_LOGIN","DOCUMENT_LOAD","SELECTION_CHANGE","SELECTION_CANCEL","ANNOTATION_CREATE","ANNOTATION_SELECT","ANNOTATION_EDIT_BEGIN","ANNOTATION_EDIT_CANCEL","ANNOTATION_SAVE_RECEIPT","login","documentLoad","href","mime","annotationSelect","uuidv4","replace","c","crypto","getRandomValues","Uint8Array","toString","annotationCreate","selection","dispatch","getState","log","end","editActiveAnnotation","activeAnnotationID","cancelEditActiveAnnotation","isEditing","saveAnnotation","comment","create","assign","shallowCopy","input","others","Array","isArray","INITIAL_STATE","reducer","action","position","BKDRHash","render","withLogout","style","ColorHash","rgb","join","className","evt","console","_keyStr","encode","output","chr1","chr2","chr3","enc1","enc2","enc3","enc4","i","_utf8_encode","charCodeAt","isNaN","charAt","string","utftext","n","fromCharCode","fileName","Base64","decodeURIComponent","split","pop","dispatcher","Download","User","lineProps","props","listMatcher","matches","match","indent","headingMatcher","quoteMatcher","renderMarkdown","md","map","index","dataset","title","Markdown","target","files","reader","FileReader","addEventListener","parseAnnotatedMarkdown","result","readAsText","rawMarkdown","matcher","Error","parse","isInitialized","getSelection","display","top","y","left","x","focus","restoreSelection","r","rangeFromOffsets","querySelector","window","removeAllRanges","addRange","initialize","isSelecting","isCollapsed","nodeName","preventDefault","getRange","pageX","pageY","textOffsetFromNode","parent","childOffset","offset","iter","createNodeIterator","NodeFilter","SHOW_TEXT","node","nextNode","referenceNode","TEXT_NODE","nodeType","textContent","getLineNumber","parseInt","getLine","Selection","TypeError","constructor","anchor","anchorNode","anchorOffset","focusNode","focusOffset","parentStart","parentEnd","createRange","s","nodeFromTextOffset","e","setStart","childTextNodeOrSelf","setEnd","counter","last","firstChild","relativeY","reduce","markers","renderAnnotationHighlight","isMine","isActive","first","mark","annotationId","backgroundColor","onclick","getBoundingClientRect","currentTarget","comm","commentText","toFormattedNodes","trim","commentEl","EditAffordance","value","formatTimestamp","timestamp","removeLast","from","str","acc","trailer","substr","toLocaleString","getComment","annotationNodes","AnnotationHighlights","annotationEls","AnnotationDetail","getPosition","offsetLeft","scrollLeft","clientLeft","offsetTop","scrollTop","clientTop","offsetParent","getBottom","offsetHeight","distributeVerically","items","nudge","prevY","MAGIC","Math","max","logger","store","next","createStore","applyMiddleware","thunk","Header","renderInto","_Header","Document","_Document","Annotations","_Annotations","_Selection","subscribe","bind","time","timeEnd","renderer","body","HTMLElement","ref","args","tree"],"mappings":"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"}